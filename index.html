<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Mami Games: PVP Arena</title>
    <style>
        body { margin: 0; background: #222; overflow: hidden; font-family: 'Arial', sans-serif; user-select: none; }
        
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        .overlay-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.92);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 20; pointer-events: auto;
        }
        
        .brand-logo {
            position: absolute; top: 30px; left: 40px;
            font-size: 32px; font-weight: 900; color: #f39c12;
            text-transform: uppercase; font-family: 'Verdana', sans-serif;
            letter-spacing: 2px; text-shadow: 3px 3px 0px #000; z-index: 30;
        }
        
        h1 { color: #e74c3c; font-size: 70px; text-shadow: 0 0 20px rgba(231, 76, 60, 0.5); margin: 0 0 20px 0; letter-spacing: 5px; font-weight: 900; }
        p { color: #ccc; font-size: 18px; max-width: 600px; text-align: center; line-height: 1.5; }
        
        .btn-group { display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap; justify-content: center; }
        button {
            background: #3498db; color: white; border: none; padding: 15px 30px;
            font-size: 18px; border-radius: 8px; cursor: pointer; font-weight: bold;
            box-shadow: 0 4px 0 #2980b9; transition: transform 0.1s;
        }
        button:active { transform: translateY(4px); box-shadow: none; }
        button:hover { background: #5dade2; }
        
        .bot-btn { background: #8e44ad; box-shadow: 0 4px 0 #6c3483; width: 100%; max-width: 300px; margin-bottom: 20px; }
        .bot-btn:hover { background: #9b59b6; }
        button.red { background: #e74c3c; box-shadow: 0 4px 0 #c0392b; }
        button.red:hover { background: #ec7063; }

        #exit-btn {
            pointer-events: auto; position: absolute; top: 20px; left: 20px;
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255,255,255,0.2);
            padding: 10px 20px; font-size: 14px; color: white; border-radius: 5px; cursor: pointer;
        }
        #exit-btn:hover { background: rgba(255, 0, 0, 0.3); border-color: red; }

        #room-info { position: absolute; top: 20px; right: 20px; color: rgba(255,255,255,0.5); font-size: 14px; text-align: right; }

        #health-container {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 300px; height: 20px; background: #111; border: 2px solid #555; border-radius: 10px; overflow: hidden;
        }
        #health-bar { width: 100%; height: 100%; background: linear-gradient(90deg, #2ecc71, #27ae60); transition: width 0.2s; }
        #health-text { 
            position: absolute; bottom: 55px; left: 50%; transform: translateX(-50%); 
            color: white; font-weight: bold; font-size: 20px; text-shadow: 1px 1px 2px black;
        }

        #countdown {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            font-size: 100px; color: yellow; font-weight: bold; text-shadow: 0 0 20px black;
            pointer-events: none; opacity: 0; transition: opacity 0.5s;
        }

        #notification {
            position: absolute; top: 20%; left: 50%; transform: translateX(-50%);
            font-size: 40px; font-weight: bold; color: yellow; text-shadow: 0 0 10px black;
            opacity: 0; transition: opacity 0.5s;
        }

        .name-input-container {
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        .name-input-container label {
            color: #f39c12;
            font-size: 16px;
            font-weight: bold;
        }
        #playerNameInput {
            padding: 12px 20px;
            font-size: 18px;
            border: 3px solid #3498db;
            border-radius: 8px;
            background: rgba(0,0,0,0.5);
            color: white;
            text-align: center;
            width: 250px;
            outline: none;
        }
        #playerNameInput:focus {
            border-color: #f39c12;
            box-shadow: 0 0 15px rgba(243, 156, 18, 0.5);
        }
        #playerNameInput::placeholder {
            color: #777;
        }
    </style>
</head>
<body>

    <div id="mainMenu" class="overlay-screen">
        <div class="brand-logo">Mami Games</div>
        <h1>PVP ARENA</h1>
        <p>Sol tƒ±k ile saldƒ±r. Ayakta kalan son takƒ±m kazanƒ±r!</p>
        
        <div class="name-input-container">
            <label for="playerNameInput">üë§ Oyuncu Adƒ±n:</label>
            <input type="text" id="playerNameInput" placeholder="ƒ∞smini gir..." maxlength="12">
        </div>
        
        <div class="btn-group" style="flex-direction: column; align-items: center;">
            <button class="bot-btn" onclick="botlaOyna()">ü§ñ BOTLARLA OYNA (Tek Ki≈üilik)</button>
            <div style="display: flex; gap: 10px;">
                <button onclick="baslat(2)">‚öîÔ∏è 1 vs 1 (Online)</button>
                <button onclick="baslat(4)">‚öîÔ∏è 2 vs 2 (Online)</button>
                <button onclick="baslat(8)">‚öîÔ∏è 4 vs 4 (Online)</button>
            </div>
        </div>
    </div>

    <div id="gameOverScreen" class="overlay-screen" style="display: none;">
        <h1 id="winnerText">OYUN Bƒ∞TTƒ∞</h1>
        <p id="subWinner">Sonu√ßlar...</p>
        <div class="btn-group">
            <button onclick="location.reload()">üîÑ Tekrar Oyna</button>
            <button class="red" onclick="cikisYap()">üè† Ana Men√º</button>
        </div>
    </div>

    <div id="ui-layer" style="display: none;">
        <button id="exit-btn" onclick="cikisYap()">‚¨Ö √áƒ±kƒ±≈ü</button>
        <div id="room-info">Oda: Bekleniyor...</div>
        <div id="health-text">50 HP</div>
        <div id="health-container">
            <div id="health-bar"></div>
        </div>
        <div id="countdown"></div>
        <div id="notification"></div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAsaLoz4P-AX6P-Pk2mzKBN1RC4Bnxlkv8",
            authDomain: "pvp-games22.firebaseapp.com",
            databaseURL: "https://pvp-games22-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "pvp-games22",
            storageBucket: "pvp-games22.firebasestorage.app",
            messagingSenderId: "669194588709",
            appId: "1:669194588709:web:cf567f35e54fb8ada065cc"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let myId = "player_" + Math.floor(Math.random() * 99999);
        let oyuncuIsmi = "Oyuncu";
        let odaAdi = "";
        let oyuncular = {};
        let hedefKisiSayisi = 0;
        let oyunAktif = false;
        let botModuAktif = false;
        let oyunBaslamaZamani = 0;
        let girisZamani = 0;
        
        let takim = "mavi"; 
        let ben = {
            x: 100, y: 100, hp: 50, maxHp: 50, yon: 1, 
            hareket: false, saldiriyor: false, sonHasarZamani: 0, 
            takim: takim, isBot: false, isim: "Oyuncu", girisZamani: 0
        };

        const tuslar = {};
        window.addEventListener('keydown', e => { tuslar[e.key] = true; if(e.code === "Space") saldir(); });
        window.addEventListener('keyup', e => tuslar[e.key] = false);
        window.addEventListener('mousedown', () => saldir());

        function boyutlandir() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.onresize = boyutlandir;
        boyutlandir();

        function isimAl() {
            let input = document.getElementById('playerNameInput').value.trim();
            if (input.length === 0) {
                oyuncuIsmi = "Oyuncu_" + Math.floor(Math.random() * 999);
            } else {
                oyuncuIsmi = input;
            }
            ben.isim = oyuncuIsmi;
        }

        function botlaOyna() {
            isimAl();
            botModuAktif = true;
            takim = "mavi"; 
            let ozelOda = "bot_room_final_" + Math.floor(Math.random() * 100000);
            baslat(2, ozelOda); 
        }

        function baslat(kisiSayisi, ozelOdaIsmi = null) {
            isimAl();
            hedefKisiSayisi = kisiSayisi;
            odaAdi = ozelOdaIsmi ? ozelOdaIsmi : "arena_online_v5_" + kisiSayisi;
            oyunBaslamaZamani = Date.now();
            girisZamani = Date.now();

            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('ui-layer').style.display = 'block';
            oyunAktif = true;

            if (botModuAktif) {
                takim = "mavi";
                ben.takim = takim;
                ben.isim = oyuncuIsmi;
                ben.girisZamani = girisZamani;
                ben.hp = 50;
                ben.x = 100 + Math.random() * 100;
                ben.y = 100 + Math.random() * (canvas.height - 200);

                db.ref(odaAdi + "/" + myId).set(ben);
                db.ref(odaAdi + "/" + myId).onDisconnect().remove();

                db.ref(odaAdi).on('value', snapshot => {
                    oyuncular = snapshot.val() || {};
                    if(!oyuncular[myId]) {
                        oyuncular[myId] = ben;
                    }
                    if(oyuncular[myId] && oyuncular[myId].hp !== undefined) {
                        ben.hp = oyuncular[myId].hp;
                    }
                    arayuzGuncelle();
                    kazanmaKontrolu();
                });

                document.getElementById('room-info').innerHTML = "Mod: BOTLARLA ANTRENMAN";
                geriSayimYap(3);
                oyunDongusu();
                return;
            }

            ben.isim = oyuncuIsmi;
            ben.girisZamani = girisZamani;
            ben.takim = "bekliyor";
            ben.hp = 50;
            ben.x = canvas.width / 2;
            ben.y = canvas.height / 2;

            db.ref(odaAdi).once('value').then(snapshot => {
                let mevcutOyuncular = snapshot.val() || {};
                
                Object.keys(mevcutOyuncular).forEach(key => {
                    if (mevcutOyuncular[key].isBot) {
                        db.ref(odaAdi + "/" + key).remove();
                    }
                });

                return db.ref(odaAdi + "/" + myId).set(ben);
            }).then(() => {
                db.ref(odaAdi + "/" + myId).onDisconnect().remove();

                db.ref(odaAdi).on('value', snapshot => {
                    oyuncular = snapshot.val() || {};
                    
                    if(!oyuncular[myId]) {
                        oyuncular[myId] = ben;
                    }
                    
                    if(oyuncular[myId] && oyuncular[myId].hp !== undefined) {
                        ben.hp = oyuncular[myId].hp;
                    }

                    let gercekOyuncular = Object.entries(oyuncular)
                        .filter(([k, p]) => !p.isBot)
                        .sort((a, b) => {
                            let zamanFark = (a[1].girisZamani || 0) - (b[1].girisZamani || 0);
                            if (zamanFark !== 0) return zamanFark;
                            return a[0].localeCompare(b[0]);
                        });

                    let benimIndex = gercekOyuncular.findIndex(([k, p]) => k === myId);
                    if (benimIndex !== -1) {
                        let yeniTakim = (benimIndex % 2 === 0) ? "mavi" : "kirmizi";
                        
                        if (ben.takim !== yeniTakim) {
                            ben.takim = yeniTakim;
                            takim = yeniTakim;
                            
                            ben.x = takim === "mavi" ? 100 + Math.random() * 100 : canvas.width - 200 + Math.random() * 100;
                            ben.y = 100 + Math.random() * (canvas.height - 200);
                            
                            db.ref(odaAdi + "/" + myId).update({ 
                                takim: yeniTakim,
                                x: ben.x,
                                y: ben.y
                            });
                        }
                    }

                    arayuzGuncelle();
                    kazanmaKontrolu();
                });

                document.getElementById('room-info').innerHTML = `Oda: ${hedefKisiSayisi} Ki≈üilik (Online)`;
                geriSayimYap(3);
                oyunDongusu();
            });
        }

        function geriSayimYap(saniye) {
            let cd = document.getElementById('countdown');
            cd.style.opacity = 1;
            cd.innerText = "HAZIR OL!";
            
            let sayac = saniye;
            let interval = setInterval(() => {
                if(sayac > 0) {
                    cd.innerText = sayac;
                    sayac--;
                } else {
                    cd.innerText = "SAVA≈û!";
                    setTimeout(() => cd.style.opacity = 0, 1000);
                    clearInterval(interval);
                }
            }, 1000);
        }

        function cikisYap() {
            if(odaAdi) db.ref(odaAdi + "/" + myId).remove();
            location.reload(); 
        }

        function arayuzGuncelle() {
            let gercekOyuncular = Object.values(oyuncular).filter(p => !p.isBot);
            let maviTakim = gercekOyuncular.filter(p => p.takim === "mavi").map(p => p.isim || "?").join(", ");
            let kirmiziTakim = gercekOyuncular.filter(p => p.takim === "kirmizi").map(p => p.isim || "?").join(", ");
            
            if(botModuAktif) {
                let botSayi = Object.values(oyuncular).filter(p => p.isBot).length;
                document.getElementById('room-info').innerHTML = `Mod: BOTLARLA ANTRENMAN<br>Botlar: ${botSayi}`;
            } else {
                document.getElementById('room-info').innerHTML = 
                    `<span style="color:#3498db">MAVƒ∞: ${maviTakim || "bekleniyor..."}</span><br>` +
                    `<span style="color:#e74c3c">KIRMIZI: ${kirmiziTakim || "bekleniyor..."}</span>`;
            }
        }

        let lastBotUpdate = 0;
        function botlariYonet() {
            if (!botModuAktif) return;

            let gercekOyuncular = Object.keys(oyuncular).filter(key => !oyuncular[key].isBot).sort();
            if (gercekOyuncular.length === 0 || gercekOyuncular[0] !== myId) return;

            let mevcutSayi = Object.keys(oyuncular).length;
            
            if (mevcutSayi < hedefKisiSayisi) {
                let spawnChance = 0.3; 
                if (Math.random() < spawnChance) { 
                    let botId = "bot_ai_" + Date.now() + Math.floor(Math.random()*100);
                    let botIsimler = ["Robo", "Terminator", "Bot", "AI", "Cyborg", "Droid", "Machine"];
                    let rastgeleIsim = botIsimler[Math.floor(Math.random() * botIsimler.length)] + "_" + Math.floor(Math.random()*99);

                    db.ref(odaAdi + "/" + botId).set({
                        x: canvas.width / 2 + (Math.random() - 0.5) * 200, 
                        y: canvas.height / 2 + (Math.random() - 0.5) * 200, 
                        hp: 50, 
                        takim: "kirmizi", 
                        isBot: true, 
                        yon: 1, 
                        hareket: false,
                        isim: rastgeleIsim
                    });
                }
            }

            if (Date.now() - lastBotUpdate > 50) { 
                Object.keys(oyuncular).forEach(key => {
                    let p = oyuncular[key];
                    if (p.isBot && p.hp > 0) {
                        let enYakinDusmanKey = null;
                        let enYakinDusman = null;
                        let minMesafe = 9999;
                        
                        Object.keys(oyuncular).forEach(targetKey => {
                            let target = oyuncular[targetKey];
                            if (target.takim !== p.takim && target.hp > 0) {
                                let d = Math.sqrt((p.x - target.x)**2 + (p.y - target.y)**2);
                                if (d < minMesafe) { 
                                    minMesafe = d; 
                                    enYakinDusman = target; 
                                    enYakinDusmanKey = targetKey;
                                }
                            }
                        });

                        let updates = {};
                        if (enYakinDusman) {
                            let hiz = 3.5; 
                            
                            if (enYakinDusman.x > p.x + 30) { p.x += hiz; p.yon = 1; p.hareket = true; }
                            else if (enYakinDusman.x < p.x - 30) { p.x -= hiz; p.yon = -1; p.hareket = true; }
                            if (enYakinDusman.y > p.y + 10) { p.y += hiz; p.hareket = true; }
                            else if (enYakinDusman.y < p.y - 10) { p.y -= hiz; p.hareket = true; }

                            if (minMesafe < 90 && !p.saldiriyor) { 
                                updates.saldiriyor = true;
                                setTimeout(() => db.ref(odaAdi + "/" + key + "/saldiriyor").set(false), 300);
                                
                                // BOT HASAR - D√úZELTƒ∞LDƒ∞
                                if (enYakinDusmanKey && oyuncular[enYakinDusmanKey]) {
                                    let hedefHp = oyuncular[enYakinDusmanKey].hp || 50;
                                    let yeniHp = Math.max(0, hedefHp - 5);
                                    db.ref(odaAdi + "/" + enYakinDusmanKey + "/hp").set(yeniHp);
                                }
                            }
                        } else { 
                            p.hareket = false; 
                        }
                        
                        updates.x = p.x; 
                        updates.y = p.y; 
                        updates.yon = p.yon; 
                        updates.hareket = p.hareket;
                        db.ref(odaAdi + "/" + key).update(updates);
                    }
                });
                lastBotUpdate = Date.now();
            }
        }

        function saldir() {
            if (ben.saldiriyor || ben.hp <= 0) return;
            ben.saldiriyor = true;
            guncelle();
            setTimeout(() => { ben.saldiriyor = false; guncelle(); }, 300);

            Object.keys(oyuncular).forEach(key => {
                let rakip = oyuncular[key];
                if (key !== myId && rakip.hp > 0) {
                    // Takƒ±m kontrol√º: Sadece farklƒ± takƒ±ma vur
                    if (rakip.takim === ben.takim) return;
                    
                    let d = Math.sqrt((rakip.x - ben.x)**2 + (rakip.y - ben.y)**2);
                    let yuzDonuk = (ben.yon === 1 && rakip.x > ben.x) || (ben.yon === -1 && rakip.x < ben.x);
                    if (d < 100 && yuzDonuk) { 
                        // OYUNCU HASAR - D√úZELTƒ∞LDƒ∞: transaction yerine set kullan
                        let yeniHp = Math.max(0, (rakip.hp || 50) - 5);
                        db.ref(odaAdi + "/" + key + "/hp").set(yeniHp);
                        bildirimGoster("VURDUN!");
                    }
                }
            });
        }

        function guncelle() {
            let veri = {
                x: ben.x, y: ben.y, yon: ben.yon, 
                hareket: ben.hp > 0 ? ben.hareket : false, 
                saldiriyor: ben.hp > 0 ? ben.saldiriyor : false, 
                takim: ben.takim, hp: ben.hp,
                isim: ben.isim,
                girisZamani: ben.girisZamani
            };
            db.ref(odaAdi + "/" + myId).update(veri);
        }

        function oyunDongusu() {
            if (!oyunAktif) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (ben.hp > 0) {
                let hareket = false;
                let hiz = 5;
                if (tuslar['w'] || tuslar['ArrowUp']) { ben.y -= hiz; hareket = true; }
                if (tuslar['s'] || tuslar['ArrowDown']) { ben.y += hiz; hareket = true; }
                if (tuslar['a'] || tuslar['ArrowLeft']) { ben.x -= hiz; ben.yon = -1; hareket = true; }
                if (tuslar['d'] || tuslar['ArrowRight']) { ben.x += hiz; ben.yon = 1; hareket = true; }
                
                ben.x = Math.max(30, Math.min(canvas.width - 30, ben.x));
                ben.y = Math.max(50, Math.min(canvas.height - 50, ben.y));
                ben.hareket = hareket;
                guncelle(); 

                if (ben.hp < 50 && Date.now() - ben.sonHasarZamani > 5000) {
                    ben.hp += 0.05;
                    if(Math.floor(ben.hp*10) % 5 === 0) db.ref(odaAdi + "/" + myId + "/hp").set(ben.hp);
                }
            } else {
                guncelle();
            }

            let barW = Math.max(0, (ben.hp / 50) * 100);
            document.getElementById('health-bar').style.width = barW + "%";
            document.getElementById('health-text').innerText = Math.max(0, Math.ceil(ben.hp)) + " HP";

            botlariYonet();
            
            let cizimSirasi = Object.entries(oyuncular).sort((a,b) => (a[1].hp <= 0 ? -1 : 1));
            cizimSirasi.forEach(([key, p]) => cizKarakter(p, key));
            
            requestAnimationFrame(oyunDongusu);
        }

        function cizKarakter(p, key) {
            ctx.save();
            ctx.translate(p.x, p.y);
            
            if (p.hp <= 0) {
                ctx.rotate(-Math.PI / 2); 
                ctx.globalAlpha = 0.6; 
            }

            ctx.fillStyle = "white"; 
            ctx.font = "bold 14px Arial"; 
            ctx.textAlign = "center";
            let gosterilenIsim = p.isim || (p.isBot ? "[BOT]" : "Oyuncu");
            if (key === myId) gosterilenIsim = "‚ñ∫ " + gosterilenIsim + " ‚óÑ";
            ctx.fillText(gosterilenIsim, 0, -55);

            ctx.font = "10px Arial";
            ctx.fillStyle = p.takim === "mavi" ? "#3498db" : "#e74c3c";
            let takimYazi = p.takim === "mavi" ? "MAVƒ∞" : (p.takim === "kirmizi" ? "KIRMIZI" : "...");
            ctx.fillText(takimYazi, 0, -67);

            if (p.hp > 0) {
                ctx.fillStyle = "red"; ctx.fillRect(-20, -45, 40, 6);
                ctx.fillStyle = "#2ecc71"; ctx.fillRect(-20, -45, (Math.max(0, p.hp) / 50) * 40, 6);
            }

            ctx.scale(p.yon, 1);
            ctx.strokeStyle = p.takim === "mavi" ? "#3498db" : "#e74c3c";
            ctx.lineWidth = 3; ctx.lineCap = "round"; ctx.lineJoin = "round";

            let time = Date.now();
            let bacakHizi = p.hareket ? Math.sin(time / 80) * 10 : 0;
            
            ctx.beginPath(); ctx.moveTo(0, -20); ctx.lineTo(0, 10); ctx.stroke(); 
            ctx.beginPath(); ctx.arc(0, -30, 10, 0, Math.PI*2); ctx.stroke(); 
            
            if (p.hp <= 0) {
                 ctx.strokeStyle = "white"; ctx.lineWidth = 1;
                 ctx.beginPath(); ctx.moveTo(2, -32); ctx.lineTo(6, -28); ctx.stroke();
                 ctx.beginPath(); ctx.moveTo(6, -32); ctx.lineTo(2, -28); ctx.stroke();
                 ctx.lineWidth = 3; ctx.strokeStyle = p.takim === "mavi" ? "#3498db" : "#e74c3c"; 
            } else {
                ctx.fillStyle = p.takim === "mavi" ? "cyan" : "orange"; 
                ctx.beginPath(); ctx.arc(4, -30, 2, 0, Math.PI*2); ctx.fill();
            }

            ctx.beginPath(); ctx.moveTo(0, 10); ctx.lineTo(-10 + bacakHizi, 35); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0, 10); ctx.lineTo(5 - bacakHizi, 35); ctx.stroke();

            let kolAcisi = p.saldiriyor ? -Math.PI / 1.5 : 0;
            ctx.beginPath(); ctx.moveTo(0, -15); ctx.lineTo(-10, 5); ctx.stroke();
            
            ctx.save();
            ctx.translate(0, -15);
            ctx.rotate(kolAcisi + (p.hareket ? Math.sin(time/80)*0.2 : 0));
            ctx.beginPath(); ctx.moveTo(0, 0); ctx.lineTo(15, 5); ctx.stroke(); 
            ctx.strokeStyle = "#ecf0f1"; ctx.lineWidth = 4; 
            ctx.beginPath(); ctx.moveTo(15, 5); ctx.lineTo(55, -5); ctx.stroke();
            ctx.restore();
            ctx.restore();
        }

        function bildirimGoster(mesaj) {
            let n = document.getElementById('notification');
            n.innerText = mesaj; n.style.opacity = 1;
            setTimeout(() => n.style.opacity = 0, 1000);
        }

        function kazanmaKontrolu() {
            if (Date.now() - oyunBaslamaZamani < 4000) return;

            let m = 0, k = 0;
            Object.values(oyuncular).forEach(p => {
                if (p.hp > 0) { if (p.takim === "mavi") m++; else if (p.takim === "kirmizi") k++; }
            });

            let toplamCanli = m + k;
            if (!botModuAktif && toplamCanli < 2) return;
            if (botModuAktif && toplamCanli === 0) return; 

            let ekran = document.getElementById('gameOverScreen');
            if (ekran.style.display !== 'none') return; 

            let mainText = document.getElementById('winnerText');
            let subText = document.getElementById('subWinner');
            
            let kazananTakim = "";
            if (m === 0 && k > 0) kazananTakim = "kirmizi";
            else if (k === 0 && m > 0) kazananTakim = "mavi";
            
            if (kazananTakim !== "") {
                if (ben.takim === kazananTakim) {
                    mainText.innerText = "YOU WIN!";
                    mainText.style.color = "#2ecc71"; 
                    subText.innerText = "Tebrikler " + oyuncuIsmi + "! D√º≈ümanlarƒ± yok ettin.";
                } else {
                    mainText.innerText = "GAME OVER";
                    mainText.style.color = "#e74c3c"; 
                    subText.innerText = oyuncuIsmi + ", sava≈ü alanƒ±nda yenildin...";
                }
                oyunBitti();
            }
        }

        function oyunBitti() {
            oyunAktif = false;
            setTimeout(() => {
                document.getElementById('gameOverScreen').style.display = 'flex';
                document.getElementById('ui-layer').style.display = 'none';
            }, 1500); 
        }
    </script>
</body>
</html>
